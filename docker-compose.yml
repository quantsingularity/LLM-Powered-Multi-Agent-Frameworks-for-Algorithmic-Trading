version: "3.8"

services:
  llm-trading:
    build:
      context: .
      dockerfile: Dockerfile
    image: llm-trading-research:latest
    container_name: llm-trading-research
    volumes:
      - ./data:/workspace/data
      - ./results:/workspace/results
      - ./figures:/workspace/figures
      - ./code:/workspace/code
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - FRED_API_KEY=${FRED_API_KEY:-}
      - WANDB_API_KEY=${WANDB_API_KEY:-}
    runtime: nvidia
    shm_size: "16gb"
    stdin_open: true
    tty: true
    command: /bin/bash

  jupyter:
    build:
      context: .
      dockerfile: Dockerfile
    image: llm-trading-research:latest
    container_name: llm-trading-jupyter
    ports:
      - "8888:8888"
    volumes:
      - ./data:/workspace/data
      - ./results:/workspace/results
      - ./figures:/workspace/figures
      - ./code:/workspace/code
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - JUPYTER_ENABLE_LAB=yes
    runtime: nvidia
    shm_size: "16gb"
    command: jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root --NotebookApp.token='' --NotebookApp.password=''
